import{r as z,j,o as T,Z as H,i as P,s as M}from"./client-ChpHOOs_.js";var U=function(u,l){return u<l?-1:u>l?1:0},R=function(u){return u.reduce(function(l,g){return l+g},0)},N=function(){function u(g){this.colors=g}var l=u.prototype;return l.palette=function(){return this.colors},l.map=function(g){return g},u}(),O=function(){function u(t,e,n){return(t<<10)+(e<<5)+n}function l(t){var e=[],n=!1;function a(){e.sort(t),n=!0}return{push:function(r){e.push(r),n=!1},peek:function(r){return n||a(),r===void 0&&(r=e.length-1),e[r]},pop:function(){return n||a(),e.pop()},size:function(){return e.length},map:function(r){return e.map(r)},debug:function(){return n||a(),e}}}function g(t,e,n,a,r,o,c){var s=this;s.r1=t,s.r2=e,s.g1=n,s.g2=a,s.b1=r,s.b2=o,s.histo=c}function f(){this.vboxes=new l(function(t,e){return U(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function v(t,e){if(e.count()){var n=e.r2-e.r1+1,a=e.g2-e.g1+1,r=Math.max.apply(null,[n,a,e.b2-e.b1+1]);if(e.count()==1)return[e.copy()];var o,c,s,p,h=0,d=[],C=[];if(r==n)for(o=e.r1;o<=e.r2;o++){for(p=0,c=e.g1;c<=e.g2;c++)for(s=e.b1;s<=e.b2;s++)p+=t[u(o,c,s)]||0;d[o]=h+=p}else if(r==a)for(o=e.g1;o<=e.g2;o++){for(p=0,c=e.r1;c<=e.r2;c++)for(s=e.b1;s<=e.b2;s++)p+=t[u(c,o,s)]||0;d[o]=h+=p}else for(o=e.b1;o<=e.b2;o++){for(p=0,c=e.r1;c<=e.r2;c++)for(s=e.g1;s<=e.g2;s++)p+=t[u(c,s,o)]||0;d[o]=h+=p}return d.forEach(function(I,m){C[m]=h-I}),function(I){var m,y,b,w,x,F=I+"1",E=I+"2",k=0;for(o=e[F];o<=e[E];o++)if(d[o]>h/2){for(b=e.copy(),w=e.copy(),x=(m=o-e[F])<=(y=e[E]-o)?Math.min(e[E]-1,~~(o+y/2)):Math.max(e[F],~~(o-1-m/2));!d[x];)x++;for(k=C[x];!k&&d[x-1];)k=C[--x];return b[E]=x,w[F]=b[E]+1,[b,w]}}(r==n?"r":r==a?"g":"b")}}return g.prototype={volume:function(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(t){var e=this,n=e.histo;if(!e._count_set||t){var a,r,o,c=0;for(a=e.r1;a<=e.r2;a++)for(r=e.g1;r<=e.g2;r++)for(o=e.b1;o<=e.b2;o++)c+=n[u(a,r,o)]||0;e._count=c,e._count_set=!0}return e._count},copy:function(){var t=this;return new g(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var e=this,n=e.histo;if(!e._avg||t){var a,r,o,c,s=0,p=0,h=0,d=0;if(e.r1===e.r2&&e.g1===e.g2&&e.b1===e.b2)e._avg=[e.r1<<3,e.g1<<3,e.b1<<3];else{for(r=e.r1;r<=e.r2;r++)for(o=e.g1;o<=e.g2;o++)for(c=e.b1;c<=e.b2;c++)s+=a=n[u(r,o,c)]||0,p+=a*(r+.5)*8,h+=a*(o+.5)*8,d+=a*(c+.5)*8;e._avg=s?[~~(p/s),~~(h/s),~~(d/s)]:[~~(8*(e.r1+e.r2+1)/2),~~(8*(e.g1+e.g2+1)/2),~~(8*(e.b1+e.b2+1)/2)]}}return e._avg},contains:function(t){var e=this,n=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,n>=e.r1&&n<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},f.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,n=0;n<e.size();n++)if(e.peek(n).vbox.contains(t))return e.peek(n).color;return this.nearest(t)},nearest:function(t){for(var e,n,a,r=this.vboxes,o=0;o<r.size();o++)((n=Math.sqrt(Math.pow(t[0]-r.peek(o).color[0],2)+Math.pow(t[1]-r.peek(o).color[1],2)+Math.pow(t[2]-r.peek(o).color[2],2)))<e||e===void 0)&&(e=n,a=r.peek(o).color);return a},forcebw:function(){var t=this.vboxes;t.sort(function(r,o){return U(R(r.color),R(o.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,a=t[n].color;a[0]>251&&a[1]>251&&a[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(t,e){if(!Number.isInteger(e)||e<1||e>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!t.length||e<2||e>256||!t.length||e<2||e>256)return!1;for(var n=[],a=new Set,r=0;r<t.length;r++){var o=t[r],c=o.join(",");a.has(c)||(a.add(c),n.push(o))}if(n.length<=e)return new N(n);var s=function(m){var y,b=new Array(32768);return m.forEach(function(w){y=u(w[0]>>3,w[1]>>3,w[2]>>3),b[y]=(b[y]||0)+1}),b}(t);s.forEach(function(){});var p=function(m,y){var b,w,x,F=1e6,E=0,k=1e6,q=0,A=1e6,S=0;return m.forEach(function(L){(b=L[0]>>3)<F?F=b:b>E&&(E=b),(w=L[1]>>3)<k?k=w:w>q&&(q=w),(x=L[2]>>3)<A?A=x:x>S&&(S=x)}),new g(F,E,k,q,A,S,y)}(t,s),h=new l(function(m,y){return U(m.count(),y.count())});function d(m,y){for(var b,w=m.size(),x=0;x<1e3;){if(w>=y||x++>1e3)return;if((b=m.pop()).count()){var F=v(s,b),E=F[0],k=F[1];if(!E)return;m.push(E),k&&(m.push(k),w++)}else m.push(b),x++}}h.push(p),d(h,.75*e);for(var C=new l(function(m,y){return U(m.count()*m.volume(),y.count()*y.volume())});h.size();)C.push(h.pop());d(C,e);for(var I=new f;C.size();)I.push(C.pop());return I}}}().quantize,D=function(u){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=u.naturalWidth,this.height=this.canvas.height=u.naturalHeight,this.context.drawImage(u,0,0,this.width,this.height)};D.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var _=function(){};_.prototype.getColor=function(u,l){return l===void 0&&(l=10),this.getPalette(u,5,l)[0]},_.prototype.getPalette=function(u,l,g){var f=function(n){var a=n.colorCount,r=n.quality;if(a!==void 0&&Number.isInteger(a)){if(a===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");a=Math.max(a,2),a=Math.min(a,20)}else a=10;return(r===void 0||!Number.isInteger(r)||r<1)&&(r=10),{colorCount:a,quality:r}}({colorCount:l,quality:g}),v=new D(u),t=function(n,a,r){for(var o,c,s,p,h,d=n,C=[],I=0;I<a;I+=r)c=d[0+(o=4*I)],s=d[o+1],p=d[o+2],((h=d[o+3])===void 0||h>=125)&&(c>250&&s>250&&p>250||C.push([c,s,p]));return C}(v.getImageData().data,v.width*v.height,f.quality),e=O(t,f.colorCount);return e?e.palette():null},_.prototype.getColorFromUrl=function(u,l,g){var f=this,v=document.createElement("img");v.addEventListener("load",function(){var t=f.getPalette(v,5,g);l(t[0],u)}),v.src=u},_.prototype.getImageData=function(u,l){var g=new XMLHttpRequest;g.open("GET",u,!0),g.responseType="arraybuffer",g.onload=function(){if(this.status==200){var f=new Uint8Array(this.response);i=f.length;for(var v=new Array(i),t=0;t<f.length;t++)v[t]=String.fromCharCode(f[t]);var e=v.join(""),n=window.btoa(e);l("data:image/png;base64,"+n)}},g.send()},_.prototype.getColorAsync=function(u,l,g){var f=this;this.getImageData(u,function(v){var t=document.createElement("img");t.addEventListener("load",function(){var e=f.getPalette(t,5,g);l(e[0],this)}),t.src=v})};T({dominantColor:M().regex(/^#([0-9A-Fa-f]{3}){1,2}$/),contrastColor:M().regex(/^#([0-9A-Fa-f]{3}){1,2}$/)});const W=T({image:P(File)}),Z=({children:u,variant:l="primary",onClick:g})=>{let f="px-4 py-2 rounded ";switch(l){case"primary":f+="bg-blue-500 text-white hover:bg-blue-700";break;case"secondary":f+="bg-gray-200 text-gray-700 hover:bg-gray-300";break;case"outline":f+="border border-blue-500 text-blue-500 hover:bg-blue-500 hover:text-white";break}return j.jsx("button",{className:f,onClick:g,children:u})},$=({onImageUpload:u})=>{const l=z.useCallback(g=>{const f=g.target.files?.[0];if(f)try{W.parse({image:f}),u(f)}catch(v){v instanceof H?(console.error("Erro de validação:",v.errors),alert("Por favor, selecione um arquivo de imagem válido.")):(console.error("Erro ao processar o arquivo:",v),alert("Ocorreu um erro ao processar o arquivo."))}},[u]);return j.jsxs("div",{children:[j.jsx("input",{type:"file",id:"image-upload",accept:"image/*",onChange:l,style:{display:"none"}}),j.jsx("label",{htmlFor:"image-upload",children:j.jsx(Z,{variant:"outline",children:"Selecionar Imagem"})})]})},B=({imageUrl:u,backgroundColor:l})=>j.jsx("div",{style:{backgroundColor:l,padding:"20px"},children:j.jsx("img",{src:u,alt:"Imagem Analisada",style:{maxWidth:"100%",maxHeight:"400px"}})}),G=()=>{const[u,l]=z.useState(null),[g,f]=z.useState("#FFFFFF"),[v,t]=z.useState(!1),[e,n]=z.useState(null),a=z.useRef(null),r=z.useCallback(async s=>{t(!0),n(null);try{const p=URL.createObjectURL(s),h=new Image;h.src=p,h.onload=async()=>{a.current=h;const C=new _().getColor(h),I=o(C);l(I);const m=c(C);f(m),t(!1)},h.onerror=()=>{n("Erro ao carregar a imagem."),t(!1)}}catch{n("Erro ao analisar a imagem."),t(!1)}},[]);function o(s){return"#"+s.map(p=>{const h=p.toString(16);return h.length===1?"0"+h:h}).join("")}function c(s){return(s[0]*299+s[1]*587+s[2]*114)/1e3>128?"#000000":"#FFFFFF"}return{analyzeImage:r,dominantColor:u,contrastColor:g,isLoading:v,error:e}},J=function(){const[l,g]=z.useState(null),{analyzeImage:f,dominantColor:v,contrastColor:t,isLoading:e,error:n}=G(),a=z.useCallback(r=>{g(URL.createObjectURL(r)),f(r)},[f]);return j.jsxs("div",{style:{padding:"20px"},children:[j.jsx("h1",{children:"Analisador de Imagem"}),j.jsx($,{onImageUpload:a}),e&&j.jsx("p",{children:"Analisando..."}),n&&j.jsx("p",{style:{color:"red"},children:n}),l&&v&&t&&j.jsx(B,{imageUrl:l,backgroundColor:t})]})};export{J as component};
